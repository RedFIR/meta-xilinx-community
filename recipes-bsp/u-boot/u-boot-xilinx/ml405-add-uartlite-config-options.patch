From f2e7ecde205d88d28536e8454f58ba2b1ef4cc81 Mon Sep 17 00:00:00 2001
From: Adrian Alonso <aalonso@secretlab.ca>
Date: Thu, 16 Dec 2010 17:34:13 -0600
Subject: [PATCH 1/2] ml405: add uartlite config options

* Add CONFIG_XILINX_UARTLITE options
* From xparameters find out which serial module
  is included in the hardware project and configure
  accord the available device

Signed-off-by: Adrian Alonso <aalonso@secretlab.ca>
---
 include/configs/ml405.h |   19 +++++++++++++++++--
 1 files changed, 17 insertions(+), 2 deletions(-)

diff --git a/include/configs/ml405.h b/include/configs/ml405.h
index d6f4832..86f093e 100644
--- a/include/configs/ml405.h
+++ b/include/configs/ml405.h
@@ -115,7 +115,6 @@
 //#define CFG_MONITOR_BASE	0xFFFC0000
 #endif
 
-#define CONFIG_BAUDRATE         9600
 #define CONFIG_BOOTDELAY        5       /* autoboot after 5 seconds	*/

 #define CONFIG_BOOTCOMMAND      "" /* autoboot command	*/
@@ -181,6 +180,18 @@
 #define CFG_MEMTEST_END		0x0C00000	/* 4 ... 12 MB in DRAM	*/

 /*
+ * Serial port
+ * uartLite
+ */
+#ifdef XPAR_UARTLITE_0_BASEADDR
+#define CONFIG_XILINX_UARTLITE
+#define CONFIG_SERIAL_BASE      XPAR_UARTLITE_0_BASEADDR
+#define CONFIG_BAUDRATE         XPAR_UARTLITE_0_BAUDRATE
+#define CONFIG_SYS_BAUDRATE_TABLE   { CONFIG_BAUDRATE }
+#define XPAR_UART_0_CLOCK_FREQ_HZ XPAR_PLB_CLOCK_FREQ_HZ
+#else
+#ifdef XPAR_UARTNS550_0_BASEADDR
+/*
  * 16550 UART and console
  */
 #define CONFIG_CONS_INDEX	1
@@ -188,8 +199,12 @@
 #define CFG_NS16550
 #define CFG_NS16550_SERIAL
 #define CFG_NS16550_REG_SIZE	-4
-#define CFG_NS16550_CLK		XPAR_XUARTNS550_CLOCK_HZ
+#define CFG_NS16550_CLK		        XPAR_XUARTNS550_CLOCK_HZ
+#define XPAR_UART_0_CLOCK_FREQ_HZ   XPAR_XUARTNS550_CLOCK_HZ
 #define CFG_NS16550_COM1	(XPAR_UARTNS550_0_BASEADDR + 0x1003)
+#define CONFIG_BAUDRATE         9600
+#endif
+#endif

 #define CFG_BAUDRATE_TABLE	\
 	{300, 600, 1200, 2400, 4800, 9600, 19200, 38400,115200}
--
1.7.2.3

